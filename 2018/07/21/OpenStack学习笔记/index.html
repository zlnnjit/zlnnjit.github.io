<!DOCTYPE html>
<html>
<head hexo-theme='https://volantis.js.org/#2020'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
    <title>OpenStack学习笔记 - zln&#39;s blog</title>
  
    <meta name="keywords" content="OpenStack">
  
  
    <meta name="description" content="
引言由于毕业和新入职的种种关系，好久没更新博客了，最近工作慢慢稳定下来，继续更新。由于本人目前从事云计算编排相关的工作，所以在业余看了一下OpenStack相关的知识，本文的内容可能十分琐碎，主要是本人在Openstack学习过程中遇到的问题和对各个组件的介绍。
">
  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css">
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">

  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  <!-- import link -->
  

  
    
<link rel="stylesheet" href="/css/style.css">

  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>
<header class="l_header shadow blur">

  <div class='wrapper'>
    <div class='nav-sub container--flex'>
      <a class="logo flat-box"></a>
      <ul class='switcher h-list'>
        <li><a class="s-comment flat-btn fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc flat-btn fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main container container--flex">
      
        
        <a class="logo flat-box" target="_self" href='/'>
          
          
          
          
            周陆宁 <b><sup style='color:#3AA757'>2020</sup></b>
          
        </a>
      

			<div class='menu navigation'>
				<ul class='h-list'>
          
          
          
            
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  
                    <i class='fas fa-rss fa-fw'></i>
                  
                  博客
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  
                    <i class='fas fa-folder-open fa-fw'></i>
                  
                  分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  
                    <i class='fas fa-tags fa-fw'></i>
                  
                  标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  
                    <i class='fas fa-archive fa-fw'></i>
                  
                  归档
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      
        <div class="m_search">
          <form name="searchform" class="form u-search-form">
            <i class="icon fas fa-search fa-fw"></i>
            <input type="text" class="input u-search-input" placeholder="搜索" />
          </form>
        </div>
      

			<ul class='switcher h-list'>
				
					<li><a class="s-search flat-btn fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li><a class="s-menu flat-btn fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a></li>
			</ul>
		</div>
	</div>
</header>
<ul class="menu-phone navigation white-box">
  
  
    <li>
      <a class="flat-box" href=/
        
        
        
          id="home"
        >
        
          <i class='fas fa-rss fa-fw'></i>
        
        博客
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/categories/
        
        
        
          id="categories"
        >
        
          <i class='fas fa-folder-open fa-fw'></i>
        
        分类
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/tags/
        
        
        
          id="tags"
        >
        
          <i class='fas fa-tags fa-fw'></i>
        
        标签
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/archives/
        
        
        
          id="archives"
        >
        
          <i class='fas fa-archive fa-fw'></i>
        
        归档
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/friends/
        
        
        
          id="friends"
        >
        
          <i class='fas fa-link fa-fw'></i>
        
        友链
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/about/
        
        
        
          id="about"
        >
        
          <i class='fas fa-info-circle fa-fw'></i>
        
        关于
      </a>
    </li>
  
</ul>
<script>setLoadingBarProgress(40);</script>



  <div class="l_body nocover">
    <div class='body-wrapper'>
      

<div class='l_main'>
  

  
    <article id="post" class="post white-box shadow article-type-post" itemscope itemprop="blogPost">
      


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/2018/07/21/OpenStack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
        OpenStack学习笔记
      </a>
    </h1>
  


      
      <div class='new-meta-box'>
        
          
        
          
            
<div class='new-meta-item author'>
  <a href="" rel="nofollow">
    <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png">
    <p>周陆宁</p>
  </a>
</div>

          
        
          
            
  
  <div class='new-meta-item category'>
    <a href='/categories/OpenStack/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>OpenStack</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2018-07-21 22:12:41</p>
  </a>
</div>

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          
          <blockquote>
<p>引言<br>由于毕业和新入职的种种关系，好久没更新博客了，最近工作慢慢稳定下来，继续更新。由于本人目前从事云计算编排相关的工作，所以在业余看了一下OpenStack相关的知识，本文的内容可能十分琐碎，主要是本人在Openstack学习过程中遇到的问题和对各个组件的介绍。</p>
</blockquote>
<a id="more"></a>

<h2 id="初识OpenStack"><a href="#初识OpenStack" class="headerlink" title="初识OpenStack"></a>初识OpenStack</h2><h3 id="Openstack"><a href="#Openstack" class="headerlink" title="Openstack"></a>Openstack</h3><p>OpenStack 已经走过了很多个年头。<br>每半年会发布一个版本，版本以字母顺序命名。<br>OpenStack最初只有两个模块（服务），现在已经有 20+（见下图），每个模块作为独立的子项目开发。</p>
<p><img src="http://img.bcoder.top/2018.07.21/1.jpg" alt="openstack学习笔记"></p>
<p>通过实际操作帮助初学者由浅入深地学习和实践 OpenStack，并最终具备实施 OpenStack 的能力。</p>
<p>我们会把学习的重点放在 OpenStack 最核心的地方。<br>那什么是核心呢？请看下图</p>
<p><img src="http://img.bcoder.top/2018.07.21/2.jpg" alt="openstack学习笔记"></p>
<p>作为 IaaS 层的云操作系统，OpenStack 为虚拟机提供并管理三大类资源：<strong>计算、网络和存储</strong>。<br>这三个就是核心，所以我们的学习重点就是：<br>搞清楚 OpenStack 是如何对计算、网络和存储资源进行管理的。<br>在 20+ 模块中，管理这三类资源的核心模块其实不多，这几个模块就是我们的重点了。</p>
<p>要达到这个目的，我们自然需要研究 OpenStack 的整体架构。<br>架构里哪些核心模块负责管理计算资源、网络资源和存储资源？模块之间如何协调工作？<br>同时我们会构建一个实验环境，进到各个模块的内部，通过实际操作真正理解和掌握 OpenStack。</p>
<p>好，下面我们就从架构开始吧。</p>
<h3 id="OpenStack架构"><a href="#OpenStack架构" class="headerlink" title="OpenStack架构"></a>OpenStack架构</h3><p>架构是个好东西，它能帮助我们站在高处看清楚事物的整体结构，避免过早地进入细节而迷失方向。</p>
<p>下图是 OpenStack 的 Conceptual Architecture</p>
<p><img src="http://img.bcoder.top/2018.07.21/3.jpg" alt="openstack学习笔记"></p>
<p>下面来介绍一下出现的组件：</p>
<p><strong>Nova</strong>：管理 VM 的生命周期，是 OpenStack 中最核心的服务。</p>
<p><strong>Neutron</strong>：为 OpenStack 提供网络连接服务，负责创建和管理L2、L3 网络，为 VM 提供虚拟网络和物理网络连接。</p>
<p><strong>Glance</strong>：管理 VM 的启动镜像，Nova 创建 VM 时将使用 Glance 提供的镜像。</p>
<p><strong>Cinder</strong>：为 VM 提供块存储服务。Cinder 提供的每一个 Volume 在 VM 看来就是一块虚拟硬盘，一般用作数据盘。</p>
<p><strong>Swift</strong>：提供对象存储服务。VM 可以通过 RESTful API 存放对象数据。作为可选的方案，Glance 可以将镜像存放在 Swift 中；Cinder 也可以将 Volume 备份到 Swift 中。</p>
<p><strong>Keystone</strong>：为 OpenStack 的各种服务提供认证和权限管理服务。简单的说，OpenStack 上的每一个操作都必须通过 Keystone 的审核。</p>
<p><strong>Ceilometer</strong>：提供 OpenStack监控和计量服务，为报警、统计或计费提供数据。</p>
<p><strong>Horizon</strong>：为 OpenStack 用户提供一个 Web 的自服务 Portal。</p>
<p>在上面的这些服务中，哪些是 OpenStack 的核心服务呢？<br>核心服务就是如果没有它，OpenStack 就跑不起来。</p>
<p>Nova 管理计算资源，是<code>核心服务</code>。</p>
<p>Neutron 管理网络资源，是<code>核心服务</code>。</p>
<p>Glance 为 VM 提供 OS 镜像，属于存储范畴，是<code>核心服务</code>。</p>
<p>Cinder 提供块存储，VM怎么也得需要数据盘吧，是<code>核心服务</code>。</p>
<p>Swift 提供对象存储，不是必须的，是<code>可选服务</code>。</p>
<p>Keystone 认证服务，没它 OpenStack 转不起来，是<code>核心服务</code>。</p>
<p>Ceilometer 监控服务，不是必须的，<code>可选服务</code>。</p>
<p>Horizon 大家都需要一个操作界面吧。</p>
<p>现在核心服务有了，接下来我们将镜头拉近点，看看核心服务内部的组成结构。<br>Logical Architecture</p>
<p><img src="http://img.bcoder.top/2018.07.21/4.jpg" alt="openstack学习笔记"></p>
<p>在 Logical Architecture 中，可以看到每个服务又由若干组件组成。<br>以 Neutron 为例，包含:</p>
<p><img src="http://img.bcoder.top/2018.07.21/5.jpg" alt="openstack学习笔记"></p>
<p>1.Neutron Server、Neutron plugins 和 Neutron agents<br>2.Network provider<br>3.消息队列 Queue<br>4.数据库 Neutron Database</p>
<p>在后面 Neutron 章节我们会展开学习这些组件。</p>
<p>这里想要强调一点：<br>上面是 Logical Architecture，描述的是 Neutron 服务各个组成部分以及各组件之间的逻辑关系。<br>而在实际的部署方案上，各个组件可以部署到不同的物理节点上。</p>
<p>OpenStack 本身是一个<code>分布式系统</code>，不但各个服务可以分布部署，服务中的组件也可以分布部署。<br>这种分布式特性让 OpenStack 具备极大的灵活性、伸缩性和高可用性。<br>当然从另一个角度讲，这也使得 OpenStack 比一般系统复杂，学习难度也更大。</p>
<h2 id="搭建OpenStack实验环境"><a href="#搭建OpenStack实验环境" class="headerlink" title="搭建OpenStack实验环境"></a>搭建OpenStack实验环境</h2><h3 id="部署拓扑"><a href="#部署拓扑" class="headerlink" title="部署拓扑"></a>部署拓扑</h3><p>首先我们来设计 OpenStack 的部署拓扑。<br>OpenStack 是一个分布式系统，由若干不同功能的节点（Node）组成：</p>
<p><strong>1.控制节点（Controller Node）</strong><br>管理 OpenStack，其上运行的服务有 Keystone、Glance、Horizon 以及 Nova 和 Neutron 中管理相关的组件。<br>控制节点也运行支持OpenStack的服务，例如SQL数据库（通常是MySQL）、消息队列（通常是RabbitMQ）和网络时间服务 NTP。        </p>
<p><strong>2.网络节点（Network Node）</strong><br>其上运行的服务为 Neutron。<br>为 OpenStack 提供 L2 和 L3 网络。<br>包括虚拟机网络、DHCP、路由、NAT 等。        </p>
<p><strong>3.存储节点（Storage Node）</strong><br>提供块存储（Cinder）或对象存储（Swift）服务。        </p>
<p><strong>4.计算节点（Compute Node）</strong><br>其上运行 Hypervisor（默认使用 KVM）。<br>同时运行 Neutron 服务的 agent，为虚拟机提供网络支持。        </p>
<p>这几类节点是<strong>从功能上</strong>进行的逻辑划分，在实际部署时可以根据需求灵活配置，比如：<br>1.在大规模OpenStack生产环境中，每类节点都分别部署在若干台物理服务器上，各司其职并互相协作。这样的环境具备很好的性能、伸缩性和高可用性。<br>2.在最小的实验环境中，可以将 4 类节点部署到一个物理的甚至是虚拟服务器上。 麻雀虽小五脏俱全，通常也称为 <code>All-in-One 部署</code>。</p>
<p>在我们的实验环境中，为了使得拓扑简洁同时功能完备，我们<strong>用两个虚拟机</strong>：<br>1.devstack-controller：控制节点 + 网络节点 + 块存储节点 + 计算节点<br>2.devstack-compute：计算节点</p>
<p>具体的环境如下图所示：</p>
<p><img src="http://img.bcoder.top/2018.07.21/6.png" alt="openstack学习笔记"></p>
<h2 id="物理资源需求"><a href="#物理资源需求" class="headerlink" title="物理资源需求"></a>物理资源需求</h2><p><img src="http://img.bcoder.top/2018.07.21/7.png" alt="openstack学习笔记"></p>
<p>CPU 和内存供参考。</p>
<p>如果是在自己的 PC 机上创建虚机部署，资源可能达不到，可以适当调整。</p>
<h2 id="网络规划"><a href="#网络规划" class="headerlink" title="网络规划"></a>网络规划</h2><p><img src="http://img.bcoder.top/2018.07.21/8.png" alt="openstack学习笔记"></p>
<p>网络上规划了三个网络：</p>
<p>1.Management Network：用于 OpenStack 内部管理用，比如各服务之间通信。这里使用 eth0        </p>
<p>2.VM（Tenant）Network：OpenStack 部署的虚拟机所使用的网络。OpenStack 支持多租户（Tenant），虚机是放在 Tenant 下的，所以叫 Tenant Network。这里使用 eth1        </p>
<p>3.External Network：一般来说，Tenant Network 是内部私有网络，只用于 VM 之间通信，与其他非 VM 网络是隔离的。这里我们规划了一个外部网络（External Network），通过 devstak-controller 的 eth2 连接。<br>Neutron 通过 L3 服务让 VM 能够访问到 External Network。<br>对于公有云，External Network 一般指的是 Internet。<br>对于企业私有云，External Network 则可以是 Intranet 中的某个网络。        </p>
<h2 id="基本"><a href="#基本" class="headerlink" title="基本"></a>基本</h2><p>配置：<br>/etc/glance/*.conf</p>
<p>日志：<br>/var/log/….</p>
<p>查看控制节点起了哪些服务：<br>openstack service list</p>
<p>source admin-openrc</p>
<p>帮助命令：<br>glance –help<br>glance help md-object-show</p>
<h2 id="各个组件"><a href="#各个组件" class="headerlink" title="各个组件"></a>各个组件</h2><h3 id="glance"><a href="#glance" class="headerlink" title="glance"></a>glance</h3><p>查看所有镜像：glance image-list<br>导出镜像: glance image-download –file /root/ubuntu14.04.img 6f4d6d2e-d678-4b7e-9625-eccd5dac76e4</p>
<p>backend:存储镜像的工具：具体使用哪种 backend，是在 /etc/glance/glance-api.conf 中配置的，一般在/var/lib/glance/images/</p>
<p>image 创建命令：<br>glance image-create –name cirros –file /tmp/cirros-0.3.4-x86_64-disk.img –disk-format qcow2 –container-format bare –progress</p>
<p>image删除命令：<br>glance image-delete <code>&lt;image-id&gt;</code></p>
<h3 id="Nova"><a href="#Nova" class="headerlink" title="Nova"></a>Nova</h3><p>查看 nova-* 子服务都分布在哪些节点上:nova service-list<br>一般来说只有nova-computer运行在计算节点上，其它进程运行在控制节点，如果控制节点也有nova-computer，说明该openstack环境是all in one 配置。</p>
<p>soft reboot 与 hard reboot 的区别在于：</p>
<ol>
<li>soft reboot 只是重启操作系统，整个过程中，instance 依然处于运行状态。相当于在 linux 中执行 reboot 命令</li>
<li>hard reboot 是重启 instance，相当于关机之后再开机</li>
</ol>
<p>Lock 与 Unlock 的区别在于：<br>对被加锁（Lock）的 instance 执行重启等改变状态的操作会提示操作不允许。执行解锁（Unlock）操作后恢复正常。Lock/Unlock 操作都是在 nova-api 中进行的。 操作成功后 nova-api 会更新 instance 加锁的状态。 执行其他操作时，nova-api 根据加锁状态来判断是否允许。</p>
<p>Pause 与 Resume 的区别在于：<br>有时需要短时间暂停 instance，可以通过 Pause 操作将 instance 的状态保存到宿主机的<strong>内存</strong>中。当需要恢复的时候，执行 Resume 操作，从内存中读回 instance 的状态，然后继续运行 instance。</p>
<p>Suspend 与 Resume 的区别在于：<br>有时需要长时间暂停 instance，可以通过 Suspend 操作将 instance 的状态保存到宿主机的<strong>磁盘</strong>上。需要恢复的时候，执行 Resume 操作，从磁盘读回 instance 的状态，然后继续运行。</p>
<p>Suspend 和 Pause 做个比较：<br>相同点<br>两者都是暂停 instance 的运行，并保存当前状态，之后可以通过 Resume 操作恢复。<br>不同点</p>
<ol>
<li>Suspend 将 instance 的状态保存在磁盘；Pause 是保存在内存中，所以 Resume 被 Pause 的 instance 要比 Suspend 快。</li>
<li>instance 被 Suspend 后，状态为 Shut Down；而被 Pause 的 instance 状态是 Paused。</li>
<li>虽然都是通过 Resume 操作恢复，Pause 对应的 Resume 在 OpenStack 内部被叫作 “Unpause”；Suspend 对应的 Resume 才是真正的 “Resume”。这个在日志中能体现出来。</li>
</ol>
<p>Rescue和UnRescue：<br>Rescue 是个很有意思的功能。它的一个使用场景是，虚机的启动盘的一个文件被误删除了导致无法再次启动了，或者 admin 的密码忘记了。Rescue 功能提供一个解决这类问题的手段。</p>
<p>Snapshot和Rebuild:<br>Nova备份的操作叫 Snapshot，其工作原理是对instance的镜像文件（系统盘）进行<strong>全量备份</strong>，生成一个类型为 snapshot 的 image，然后将其保存到 Glance 上。从备份恢复的操作叫 Rebuild。</p>
<p>shelve和unshelve：<br>Instance 被 Suspend 后虽然处于 Shut Down 状态，但 Hypervisor 依然在宿主机上为其预留了资源，以便在以后能够成功 Resume。如果希望释放这些预留资源，可以使用 Shelve 操作。 Shelve 会将 instance 作为 image 保存到 Glance 中，然后在宿主机上删除该 instance。<br>因为 Glance 中保存了 instance 的 image，unshelve 的过程其实就是通过该 image launch 一个新的 instance，nova-scheduler 也会调度合适的计算节点来创建该 instance。<br>instance unshelve 后可能运行在与 shelve 之前不同的计算节点上，但 instance 的其他属性（比如 flavor，IP 等）不会改变。</p>
<p>Migrate：<br>Migrate 操作的作用是将 instance 从当前的计算节点迁移到其他节点上。<br>Migrate 不要求源和目标节点必须共享存储，当然共享存储也是可以的。 Migrate 前必须满足一个条件：计算节点间需要配置 nova 用户无密码访问。<br>迁移过程中源和目标节点之前需要使用 ssh 和 scp，为了使操作顺利进行，必须要保证 nova-compute 进程的启动用户（通常是 nova，也可能是 root，可以通过 ps 命令确认）能够在计算节点之间无密码访问。否则 nova-compute 会等待密码输入，但后台服务是无法输入密码的，迁移操作会一直卡在那里。</p>
<p>Resize ：<br>Resize 的作用是调整 instance 的 vCPU、内存和磁盘资源。<br>Instance 需要多少资源是定义在 flavor 中的，resize 操作是通过为 instance 选择新的 flavor 来调整资源的分配。</p>
<p>Live Migrate：<br>Migrate 操作会先将 instance 停掉，也就是所谓的“冷迁移”。而 Live Migrate 是“热迁移”，也叫“在线迁移”，instance不会停机。<br>Live Migrate 分两种：<br>1.源和目标节点没有共享存储，instance 在迁移的时候需要将其镜像文件从源节点传到目标节点，这叫做 Block Migration（块迁移）<br>2.源和目标节点共享存储，instance 的镜像文件不需要迁移，只需要将 instance 的状态迁移到目标节点。<br>源和目标节点需要满足一些条件才能支持 Live Migration：<br>1.源和目标节点的 CPU 类型要一致。<br>2.源和目标节点的 Libvirt 版本要一致。<br>3.源和目标节点能相互识别对方的主机名称，比如可以在 /etc/hosts 中加入对方的条目。<br>4.在源和目标节点的 /etc/nova/nova.conf 中指明在线迁移时使用 TCP 协议。<br>5.Instance 使用 config driver 保存其 metadata。在 Block Migration 过程中，该 config driver 也需要迁移到目标节点。由于目前 libvirt 只支持迁移 vfat 类型的 config driver，所以必须在 /etc/nova/nova.conf 中明确指明 launch instance 时创建 vfat 类型的 config driver。<br>6.源和目标节点的 Libvirt TCP 远程监听服务得打开。</p>
<p>Evacuate：<br>Evacuate 可在 nova-compute 无法工作的情况下将节点上的 instance 迁移到其他计算节点上。但有个前提： Instance 的镜像文件必须放在共享存储上。</p>
<h3 id="Cinder"><a href="#Cinder" class="headerlink" title="Cinder"></a>Cinder</h3><p>操作系统获得存储空间的方式一般有两种：<br>1.通过某种协议（SAS,SCSI,SAN,iSCSI 等）挂接裸硬盘，然后分区、格式化、创建文件系统；或者直接使用裸硬盘存储数据（数据库）<br>2.通过 NFS、CIFS 等 协议，mount 远程的文件系统<br>第一种裸硬盘的方式叫做 Block Storage（块存储），每个裸硬盘通常也称作 Volume（卷） 第二种叫做文件系统存储。NAS 和 NFS 服务器，以及各种分布式文件系统提供的都是这种存储。</p>
<p>Cinder具体功能是：<br>1.提供 REST API 使用户能够查询和管理 volume、volume snapshot 以及 volume type<br>2.提供 scheduler 调度 volume 创建请求，合理优化存储资源的分配<br>3.通过 driver 架构支持多种 back-end（后端）存储方式，包括 LVM，NFS，Ceph 和其他诸如 EMC、IBM 等商业存储产品和方案(默认是LVM)</p>
<p>attach和detach:<br>通过 attach 操作为 instance 添加了 volume，而与之相对的操作是 detach，就是将 volume 从 instance 上卸载下来。</p>
<p>Extend:<br>为了保护现有数据，cinder 不允许缩小 volume。<br>Extend 操作用于扩大 Volume 的容量，状态为 Available 的 volume 才能够被 extend。如果 volume 当前已经 attach 给 instance，需要先 detach 后才能 extend。</p>
<p>delete:<br>状态为 Available 的 volume 才能够被 delete。 如果 volume 当前已经 attach 到 instance，需要先 detach 后才能 delete。</p>
<p>Snapshot:<br>Snapshot 可以为 volume 创建快照，快照中保存了 volume 当前的状态，以后可以通过 snapshot 回溯。(需要注意的是nova也会为instance进行快照)。如果一个 volume 存在 snapshot，则这个 volume 是无法删除的。这是因为 snapshot 依赖于 volume，snapshot 无法独立存在。在 LVM 作为 volume provider 的环境中，snapshot 是从源 volume 完全 copy 而来，所以这种依赖关系不强。但在其他 volume provider（比如商业存储设备或者分布式文件系统），snapshot 通常是源 volume 创建快照时数据状态的一个引用（指针），占用空间非常小，在这种实现方式里 snapshot 对源 volume 的依赖就非常明显了。</p>
<p>Backup VS Snapshot：<br>初看 backup 功能好像与 snapshot 很相似，都可以保存 volume 的当前状态，以备以后恢复。但二者在用途和实现上还是有区别的，具体表现在：<br>1.Snapshot 依赖于源 volume，不能独立存在；而 backup 不依赖源 volume，即便源 volume 不存在了，也可以 restore。<br>2.Snapshot 与源 volume 通常存放在一起，都由同一个 volume provider 管理；而 backup 存放在独立的备份设备中，有自己的备份方案和实现，与 volume provider 没有关系。<br>上面两点决定了 backup 具有容灾功能；而 snapshot 则提供 volume provider 内便捷的回溯功能。<br>Cinder 的 backup 功能是由 cinder-backup 服务提供的，devstack 默认没有启用该服务，需要手工启用。</p>
<p>restore：<br>restore 的过程其实很简单，两步走：<br>在存储节点上创建一个空白 volume。<br>将 backup 的数据 copy 到空白 voluem 上。</p>
<h3 id="Keystone"><a href="#Keystone" class="headerlink" title="Keystone"></a>Keystone</h3><p>查看 Endpoint（Endpoint 是一个网络上可访问的地址，通常是一个 URL。Service 通过 Endpoint 暴露自己的 API。 Keystone 负责管理和维护每个 Service 的 Endpoint。）：openstack catalog list</p>
<p>查看角色：openstack role list</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>1.从控制节点查看计算节点</p>
<p>ssh到控制节点：vim /etc/hosts<br>或者：<br>web登录（推荐火狐）：http://<controller-ip>/horizon</p>
<p>admin—&gt;system—&gt;Hypervisor可以查看到计算节点信息。</p>
<p>2.执行命令出现如下报错<br>You must provide a username via either –os-username or env[OS_USERNAME]</p>
<p>解决<br>source admin-openrc.sh</p>
<p>3.log:<br>非devstack:/var/log/glance/<br>devstack： /opt/stack/logs</p>
<p>4.实例转镜像：<br>实例目录<br>/var/lib/nova/instances/<br>qemu-img convert -f qcow2 -O qcow2 disk image_name.qcow2<br>执行如下命令压缩文件：<br>qemu-img convert -c -O qcow2 image_name.qcow2 image_new.qcow2</p>

          
            <br>
            
  
    
    

<section class="widget copyright  desktop mobile">
  <div class='content'>
    
      <blockquote>
        
          
            <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

          
        
          
            <p>本文永久链接是：<a href=https://www.bcoder.top/2018/07/21/OpenStack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>https://www.bcoder.top/2018/07/21/OpenStack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></p>
          
        
      </blockquote>
    
  </div>
</section>

  

  
    
    

<section class="widget qrcode  desktop mobile">
  

  <div class='content article-entry'>
    
      
        <div class='fancybox'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/qrcode/wiki_volantis.png'
        
          height='64px'
        ></div>
      
    
      
        <div class='fancybox'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/qrcode/wiki_volantis.png'
        
          height='64px'
        ></div>
      
    
  </div>
</section>

  


          
        </div>
        
          


  <section class='meta' id="footer-meta">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-01-21T18:44:03+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：2020-01-21 18:44:03</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/OpenStack/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>OpenStack</p></a></div>


        
      
        
          

        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.bcoder.top/2018/07/21/OpenStack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=OpenStack学习笔记 - zln's blog&summary=
引言由于毕业和新入职的种种关系，好久没更新博客了，最近工作慢慢稳定下来，继续更新。由于本人目前从事云计算编排相关的工作，所以在业余看了一下OpenStack相关的知识，本文的内容可能十分琐碎，主要是本人在Openstack学习过程中遇到的问题和对各个组件的介绍。
"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://www.bcoder.top/2018/07/21/OpenStack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=OpenStack学习笔记 - zln's blog&summary=
引言由于毕业和新入职的种种关系，好久没更新博客了，最近工作慢慢稳定下来，继续更新。由于本人目前从事云计算编排相关的工作，所以在业余看了一下OpenStack相关的知识，本文的内容可能十分琐碎，主要是本人在Openstack学习过程中遇到的问题和对各个组件的介绍。
"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=https://www.bcoder.top/2018/07/21/OpenStack%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=OpenStack学习笔记 - zln's blog&summary=
引言由于毕业和新入职的种种关系，好久没更新博客了，最近工作慢慢稳定下来，继续更新。由于本人目前从事云计算编排相关的工作，所以在业余看了一下OpenStack相关的知识，本文的内容可能十分琐碎，主要是本人在Openstack学习过程中遇到的问题和对各个组件的介绍。
"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
          <div class="prev-next">
            
              <a class='prev' href='/2018/07/28/Neutron%E5%AD%A6%E4%B9%A0/'>
                <p class='title'><i class="fas fa-chevron-left" aria-hidden="true"></i>Neutron学习</p>
                <p class='content'>
引言本文主要讲解OpenStack的核心组件Neutron,本文的主要内容引子CloudMan的公众号系列文章，本文仅仅对Neutron做了一个简单的学习，后面会进行深入学习。


Neutr...</p>
              </a>
            
            
              <a class='next' href='/2018/04/15/%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%EF%BC%9AHashMap%EF%BC%88jdk7%EF%BC%89/'>
                <p class='title'>源码学习：HashMap（jdk7）<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
                <p class='content'>
引言最近忙着实习和做毕设，博客有一段时间没有更新了（剑指offer刷题还是在每日更新的），现在终于稍微有点时间继续学习了，打算最近把比较常用的类的源码看看。目前计算学习的类有HashMap（j...</p>
              </a>
            
          </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: 'OpenStack学习笔记',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
  

  
    
    


  <section class="widget toc-wrapper shadow desktop mobile">
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#初识OpenStack"><span class="toc-text">初识OpenStack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Openstack"><span class="toc-text">Openstack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenStack架构"><span class="toc-text">OpenStack架构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#搭建OpenStack实验环境"><span class="toc-text">搭建OpenStack实验环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#部署拓扑"><span class="toc-text">部署拓扑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#物理资源需求"><span class="toc-text">物理资源需求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网络规划"><span class="toc-text">网络规划</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基本"><span class="toc-text">基本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#各个组件"><span class="toc-text">各个组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#glance"><span class="toc-text">glance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nova"><span class="toc-text">Nova</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cinder"><span class="toc-text">Cinder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Keystone"><span class="toc-text">Keystone</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#问题"><span class="toc-text">问题</span></a></li></ol>
    </div>
  </section>


  


</aside>


  
  <footer class="clearfix">
    <br><br>
    
      
        <div class="aplayer-container">
          

  
    <meting-js
      theme='#1BCDFC'
      autoplay='false'
      volume='0.7'
      loop='all'
      order='list'
      fixed='false'
      list-max-height='340px'
      server='netease'
      type='playlist'
      id='3175833810'
      list-folded='true'>
    </meting-js>
  


        </div>
      
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="/atom.xml"
                class="social fas fa-rss flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="mailto:me@xaoxuu.com"
                class="social fas fa-envelope flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://github.com/xaoxuu"
                class="social fab fa-github flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://music.163.com/#/user/home?id=63035382"
                class="social fas fa-headphones-alt flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
        </div>
      
    
      
        <div><p>Blog content follows the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
      
    
      
        Use
        <a href="https://bcoder,top/" target="_blank" class="codename">周陆宁</a>
        as theme
        
          , 
          total visits
          <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
          times
        
      
    
      
        <div class='copyright'>
        <p><a href="https://xaoxuu.com" target="_blank" rel="noopener">Copyright © 2017-2020 Mr. X</a></p>

        </div>
      
    
  </footer>

<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4/dist/jquery.min.js"></script>


  <script>
    
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>



  
<script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>

  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>



  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('.cover') {
          $('.cover').backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        }
      });
    </script>
  



  
    
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js" async></script>

  
    
<script src="https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js" async></script>

  










  
<script src="/js/app.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.1/js/search.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/comment_typing.js"></script>



<!-- 复制 -->

  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copyed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-clipboard-check');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPYED';
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-exclamation-triangle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
      });
    }
    initCopyCode();
  }(window, document);
</script>




<!-- fancybox -->

  <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("div.fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>






  <script>setLoadingBarProgress(100);</script>
</body>
</html>

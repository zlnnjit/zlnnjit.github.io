<!DOCTYPE html>
<html>
<head hexo-theme='https://volantis.js.org/#2020'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
    <title>微服务容器化实践（一） - zln&#39;s blog</title>
  
    <meta name="keywords" content="docker,微服务,CI/CD">
  
  
    <meta name="description" content="Docker 基础Docker介绍Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从Apache2.0协议开源。
Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。
容器是完全使用沙箱机制，相互之间不会有任何接...">
  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css">
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">

  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  <!-- import link -->
  

  
    
<link rel="stylesheet" href="/css/style.css">

  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<body>
  
  <div class="cover-wrapper">
    
      <cover class='cover post half'>
        <div class='cover-body'>
  <div class='a'>
    
    
      <p class="title">bcoder.top</p>
    
    
      <p class="subtitle">不忘初心，无畏前行</p>
    
  </div>
  <div class='b'>
    
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <input type="text" class="input u-search-input" placeholder="" />
          <i class="icon fas fa-search fa-fw"></i>
        </form>
      </div>
    
    <div class='menu navigation'>
      <ul class='h-list'>
        
          
            <li>
              <a class="nav home"
                href="/"
                
                
                id="home">
                <i class='fas fa-rss fa-fw'></i>&nbsp;博客
              </a>
            </li>
          
            <li>
              <a class="nav home"
                href="/categories/"
                
                
                id="categories">
                <i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
              </a>
            </li>
          
            <li>
              <a class="nav home"
                href="/tags/"
                
                
                id="tags">
                <i class='fas fa-tags fa-fw'></i>&nbsp;标签
              </a>
            </li>
          
            <li>
              <a class="nav home"
                href="/archives/"
                
                
                id="archives">
                <i class='fas fa-archive fa-fw'></i>&nbsp;归档
              </a>
            </li>
          
            <li>
              <a class="nav home"
                href="https://github.com/zlnnjit"
                
                
                  target="_blank"
                
                id="https:githubcomzlnnjit">
                <i class='fas fa-link fa-fw'></i>&nbsp;github
              </a>
            </li>
          
            <li>
              <a class="nav home"
                href="/about/"
                
                
                id="about">
                <i class='fas fa-info-circle fa-fw'></i>&nbsp;关于
              </a>
            </li>
          
        
      </ul>
    </div>
  </div>
</div>

      </cover>
    
    <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>
<header class="l_header shadow blur">

  <div class='wrapper'>
    <div class='nav-sub container--flex'>
      <a class="logo flat-box"></a>
      <ul class='switcher h-list'>
        <li><a class="s-comment flat-btn fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc flat-btn fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main container container--flex">
      
        
        <a class="logo flat-box" target="_self" href='/'>
          
          
          
          
            周陆宁 <b><sup style='color:#3AA757'>2020</sup></b>
          
        </a>
      

			<div class='menu navigation'>
				<ul class='h-list'>
          
          
          
            
            
              <li>
                <a class="flat-box" href=/
                  
                  
                  
                    id="home"
                  >
                  
                    <i class='fas fa-rss fa-fw'></i>
                  
                  博客
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  
                    <i class='fas fa-folder-open fa-fw'></i>
                  
                  分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  
                    <i class='fas fa-tags fa-fw'></i>
                  
                  标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  
                    <i class='fas fa-archive fa-fw'></i>
                  
                  归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=https://github.com/zlnnjit
                  
                  
                    target="_blank"
                  
                  
                    id="https:githubcomzlnnjit"
                  >
                  
                    <i class='fas fa-link fa-fw'></i>
                  
                  github
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="flat-box" href=/about/
                  
                  
                  
                    id="about"
                  >
                  
                    <i class='fas fa-info-circle fa-fw'></i>
                  
                  关于
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      
        <div class="m_search">
          <form name="searchform" class="form u-search-form">
            <i class="icon fas fa-search fa-fw"></i>
            <input type="text" class="input u-search-input" placeholder="搜索" />
          </form>
        </div>
      

			<ul class='switcher h-list'>
				
					<li><a class="s-search flat-btn fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li><a class="s-menu flat-btn fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a></li>
			</ul>
		</div>
	</div>
</header>
<ul class="menu-phone navigation white-box">
  
  
    <li>
      <a class="flat-box" href=/
        
        
        
          id="home"
        >
        
          <i class='fas fa-rss fa-fw'></i>
        
        博客
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/categories/
        
        
        
          id="categories"
        >
        
          <i class='fas fa-folder-open fa-fw'></i>
        
        分类
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/tags/
        
        
        
          id="tags"
        >
        
          <i class='fas fa-tags fa-fw'></i>
        
        标签
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/archives/
        
        
        
          id="archives"
        >
        
          <i class='fas fa-archive fa-fw'></i>
        
        归档
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/friends/
        
        
        
          id="friends"
        >
        
          <i class='fas fa-link fa-fw'></i>
        
        友链
      </a>
    </li>
  
    <li>
      <a class="flat-box" href=/about/
        
        
        
          id="about"
        >
        
          <i class='fas fa-info-circle fa-fw'></i>
        
        关于
      </a>
    </li>
  
</ul>
<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      

<div class='l_main'>
  

  
    <article id="post" class="post white-box shadow article-type-post" itemscope itemprop="blogPost">
      


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/2019/01/13/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%E5%8C%96%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/">
        微服务容器化实践（一）
      </a>
    </h1>
  


      
      <div class='new-meta-box'>
        
          
        
          
            
<div class='new-meta-item author'>
  <a href="" rel="nofollow">
    <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png">
    <p>周陆宁</p>
  </a>
</div>

          
        
          
            
  
  <div class='new-meta-item category'>
    <a href='/categories/CI-CD/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>CI/CD</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2019-01-13 21:37:52</p>
  </a>
</div>

          
        
          
            
  <div class="new-meta-item wordcount">
    <a class='notlink'>
      <i class="fas fa-keyboard fa-fw" aria-hidden="true"></i>
      <p>字数：4.7k</p>
    </a>
  </div>
  <div class="new-meta-item readtime">
    <a class='notlink'>
      <i class="fas fa-hourglass-half fa-fw" aria-hidden="true"></i>
      <p>时长：20 分钟</p>
    </a>
  </div>


          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          
          <h2 id="Docker-基础"><a href="#Docker-基础" class="headerlink" title="Docker 基础"></a>Docker 基础</h2><h3 id="Docker介绍"><a href="#Docker介绍" class="headerlink" title="Docker介绍"></a>Docker介绍</h3><p>Docker 是一个开源的应用容器引擎，基于 <a href="http://www.runoob.com/go/go-tutorial.html" target="_blank" rel="noopener">Go 语言</a> 并遵从Apache2.0协议开源。</p>
<p>Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。</p>
<p>容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。</p>
<a id="more"></a>



<h3 id="Docker应用场景"><a href="#Docker应用场景" class="headerlink" title="Docker应用场景"></a>Docker应用场景</h3><ul>
<li>Web 应用的自动化打包和发布。</li>
<li>自动化测试和持续集成、发布。</li>
<li>在服务型环境中部署和调整数据库或其他的后台应用。</li>
<li>从头编译或者扩展现有的OpenShift或Cloud Foundry平台来搭建自己的PaaS环境。</li>
</ul>
<h3 id="Docker优点"><a href="#Docker优点" class="headerlink" title="Docker优点"></a>Docker优点</h3><ul>
<li><strong>1、简化程序</strong><br>Docker 让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，便可以实现虚拟化。Docker改变了虚拟化的方式，使开发者可以直接将自己的成果放入Docker中进行管理。方便快捷已经是 Docker的最大优势，过去需要用数天乃至数周的    任务，在Docker容器的处理下，只需要数秒就能完成。</li>
<li><strong>2、避免选择恐惧症</strong><br>如果你有选择恐惧症，还是资深患者。Docker 帮你    打包你的纠结！比如 Docker 镜像；Docker 镜像中包含了运行环境和配置，所以 Docker 可以简化部署多种应用实例工作。比如 Web 应用、后台应用、数据库应用、大数据应用比如 Hadoop 集群、消息队列等等都可以打包成一个镜像部署。</li>
<li><strong>3、节省开支</strong><br>一方面，云计算时代到来，使开发者不必为了追求效果而配置高额的硬件，Docker 改变了高性能必然高价格的思维定势。Docker 与云的结合，让云空间得到更充分的利用。不仅解决了硬件管理的问题，也改变了虚拟化的方式。</li>
</ul>
<h3 id="Docker安装（以ubuntu-16-04-为例）"><a href="#Docker安装（以ubuntu-16-04-为例）" class="headerlink" title="Docker安装（以ubuntu 16.04 为例）"></a>Docker安装（以ubuntu <strong>16.04</strong> 为例）</h3><p>1.选择国内的云服务商，这里选择阿里云为例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL http:&#x2F;&#x2F;acs-public-mirror.oss-cn-hangzhou.aliyuncs.com&#x2F;docker-engine&#x2F;internet | sh -</span><br></pre></td></tr></table></figure>

<p>2.安装所需要的包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install linux-image-extra-$(uname -r) linux-image-extra-virtual</span><br></pre></td></tr></table></figure>

<p>3.添加使用 HTTPS 传输的软件包以及 CA 证书</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install apt-transport-https ca-certificates</span><br></pre></td></tr></table></figure>

<p>4.添加GPG密钥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-key adv --keyserver hkp:&#x2F;&#x2F;p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D</span><br></pre></td></tr></table></figure>

<p>5.添加软件源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;deb https:&#x2F;&#x2F;apt.dockerproject.org&#x2F;repo ubuntu-xenial main&quot; | sudo tee &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;docker.list</span><br></pre></td></tr></table></figure>

<p>6.添加成功后更新软件包缓存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<p>7.安装docker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install docker-engine</span><br></pre></td></tr></table></figure>

<p>8.启动 docker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable docker</span><br></pre></td></tr></table></figure>



<p>相关文档链接收藏：</p>
<p>docker官方文档：<a href="https://docs.docker.com/" target="_blank" rel="noopener">https://docs.docker.com/</a></p>
<p>docker安装： <code>sudo apt-get -y install docker.io</code>（不是最新的版本）<br>最新版本安装：<a href="https://blog.csdn.net/wangxiong2010/article/details/79178588（速度慢。建议vpn）" target="_blank" rel="noopener">https://blog.csdn.net/wangxiong2010/article/details/79178588（速度慢。建议vpn）</a><br>docker升级：<a href="https://blog.csdn.net/bruceleenumberone/article/details/78692494" target="_blank" rel="noopener">https://blog.csdn.net/bruceleenumberone/article/details/78692494</a><br>docker卸载：<a href="https://www.cnblogs.com/wxjnew/p/8024271.html" target="_blank" rel="noopener">https://www.cnblogs.com/wxjnew/p/8024271.html</a><br>docker-enter：<a href="https://blog.csdn.net/justdoithai/article/details/52727480" target="_blank" rel="noopener">https://blog.csdn.net/justdoithai/article/details/52727480</a></p>
<p>docker中国：<a href="http://www.docker.org.cn/" target="_blank" rel="noopener">http://www.docker.org.cn/</a></p>
<p><em>Docker</em> <em>中国</em>官方镜像加速: <a href="http://docker-cn.com/" target="_blank" rel="noopener">http://docker-cn.com/</a></p>
<p>docker hub切换国内镜像：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https:&#x2F;&#x2F;get.daocloud.io&#x2F;daotools&#x2F;set_mirror.sh | sh -s http:&#x2F;&#x2F;ef017c13.m.daocloud.io</span><br></pre></td></tr></table></figure>

<p>安装之后启动 Docker 服务:<code>sudo service docker start</code><br>查看版本：<code>docker --version</code></p>
<h3 id="Docker镜像操作"><a href="#Docker镜像操作" class="headerlink" title="Docker镜像操作"></a>Docker镜像操作</h3><p>docker pull 获取ubuntu镜像:<code>docker pull ubuntu</code><br>有时候官方仓库注册服务器下载较慢，可以从其他仓库下载。从其它仓库下载时需要指定完整的仓库注册服务器地址。例如<code>sudo docker pull dl.dockerpool.com:5000/ubuntu</code></p>
<p><strong>Docker 中国官方镜像加速</strong>:<a href="http://www.docker-cn.com/registry-mirror" target="_blank" rel="noopener">http://www.docker-cn.com/registry-mirror</a></p>
<p>指定版本：<code>docker pull ubuntu:14.04</code><br>列出所有镜像：<code>docker images</code><br>删除镜像:<code>docker rmi [dockerid]</code><br>导出镜像：<code>sudo docker save -o ubuntu.tar ubuntu</code><br>导入docker镜像：<code>docker load &lt; guaca_v3.5.5.tar</code></p>
<h3 id="Docker容器操作"><a href="#Docker容器操作" class="headerlink" title="Docker容器操作"></a>Docker容器操作</h3><p>查看正在运行的docker容器：<code>docker ps</code><br>查看所有docker容器：<code>docker ps -a</code></p>
<p>启动docker容器：<code>docker start  dockername/containerid</code><br>进入docker容器:<code>docker-enter dockername/containerid</code><br>删除容器：<code>docker rm  trusting_newton</code></p>
<p>使用nsenter进入Docker容器(docker-enter):<a href="https://blog.csdn.net/fenglailea/article/details/44900401" target="_blank" rel="noopener">https://blog.csdn.net/fenglailea/article/details/44900401</a></p>
<p>docker run常用参数：</p>
<ul>
<li><p>-p out_port:in_port 端口映射</p>
</li>
<li><p>–name <code>&lt;docker_image&gt;</code> 指定docker实例名称</p>
</li>
<li><p>-v out_path:in_path 映射配置文件</p>
</li>
<li><p>-d <code>&lt;image&gt;</code> 指定镜像</p>
</li>
<li><p>-t:在新容器内指定一个伪终端或终端。</p>
</li>
<li><p>-i:允许你对容器内的标准输入 (STDIN) 进行交互。</p>
</li>
</ul>
<h3 id="Docker常用镜像安装"><a href="#Docker常用镜像安装" class="headerlink" title="Docker常用镜像安装"></a>Docker常用镜像安装</h3><h4 id="Docker-安装-Nginx"><a href="#Docker-安装-Nginx" class="headerlink" title="Docker 安装 Nginx"></a>Docker 安装 Nginx</h4><p>1.拉取镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker search nginx</span><br><span class="line">docker pull nginx</span><br><span class="line">docker images nginx</span><br></pre></td></tr></table></figure>

<p>2.启动镜像</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 80:80 --name mynginx -v PWD/www:/www -v PWD/conf/nginx.conf:/etc/nginx/nginx.conf -v <span class="variable">$PWD</span>/logs:/wwwlogs  -d nginx</span><br></pre></td></tr></table></figure>

<p>45c89fab0bf9ad643bc7ab571f3ccd65379b844498f54a7c8a4e7ca1dc3a2c1e</p>
<p>命令说明：</p>
<ul>
<li><strong>-p 80:80：</strong>将容器的80端口映射到主机的80端口</li>
<li><strong>–name mynginx：</strong>将容器命名为mynginx</li>
<li><strong>-v $PWD/www:/www：</strong>将主机中当前目录下的www挂载到容器的/www</li>
<li><strong>-v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf：</strong>将主机中当前目录下的nginx.conf挂载到容器的/etc/nginx/nginx.conf</li>
<li><strong>-v $PWD/logs:/wwwlogs：</strong>将主机中当前目录下的logs挂载到容器的/wwwlogs</li>
</ul>
<h4 id="Docker-安装-MySQL"><a href="#Docker-安装-MySQL" class="headerlink" title="Docker 安装 MySQL"></a>Docker 安装 MySQL</h4><p>1.拉取镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql</span><br><span class="line">docker pull mysql:5.7</span><br><span class="line">docker images mysql</span><br></pre></td></tr></table></figure>

<p>2.启动镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3306:3306 --name mymysql -v $PWD&#x2F;conf:&#x2F;etc&#x2F;mysql&#x2F;conf.d -v $PWD&#x2F;logs:&#x2F;logs -v $PWD&#x2F;data:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;123456 -d mysql:5.7</span><br></pre></td></tr></table></figure>

<p>命令说明：</p>
<ul>
<li><strong>-p 3306:3306</strong>：将容器的 3306 端口映射到主机的 3306 端口。</li>
<li><strong>-v -v $PWD/conf:/etc/mysql/conf.d</strong>：将主机当前目录下的 conf/my.cnf 挂载到容器的 /etc/mysql/my.cnf。</li>
<li><strong>-v $PWD/logs:/logs</strong>：将主机当前目录下的 logs 目录挂载到容器的 /logs。</li>
<li><strong>-v $PWD/data:/var/lib/mysql</strong> ：将主机当前目录下的data目录挂载到容器的 /var/lib/mysql 。</li>
<li><strong>-e MYSQL_ROOT_PASSWORD=123456：</strong>初始化 root 用户的密码。</li>
</ul>
<h4 id="Docker-安装-Tomcat"><a href="#Docker-安装-Tomcat" class="headerlink" title="Docker 安装 Tomcat"></a>Docker 安装 Tomcat</h4><p>1.拉取镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker search tomcat</span><br><span class="line">docker pull tomcat</span><br><span class="line">docker images tomcat</span><br></pre></td></tr></table></figure>

<p>2.启动镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name tomcat -p 8080:8080 -v $PWD&#x2F;test:&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;test -d tomcat</span><br></pre></td></tr></table></figure>

<p>命令说明：</p>
<ul>
<li><strong>-p 8080:8080：</strong>将容器的8080端口映射到主机的8080端口</li>
<li><strong>-v $PWD/test:/usr/local/tomcat/webapps/test：</strong>将主机中当前目录下的test挂载到容器的/test</li>
</ul>
<h4 id="Docker-安装-Redis"><a href="#Docker-安装-Redis" class="headerlink" title="Docker 安装 Redis"></a>Docker 安装 Redis</h4><p>1.拉取镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker search redis</span><br><span class="line">docker pull redis:3.7</span><br><span class="line">docker images redis</span><br></pre></td></tr></table></figure>

<p>2.启动镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 6379:6379 –name redis -v &#x2F;root&#x2F;redis&#x2F;redis.conf:&#x2F;etc&#x2F;redis&#x2F;redis.conf -v &#x2F;root&#x2F;redis&#x2F;data:&#x2F;data -d redis:3.7 redis-server &#x2F;etc&#x2F;redis&#x2F;redis.conf –appendonly yes</span><br></pre></td></tr></table></figure>

<p>命令说明：</p>
<ul>
<li><strong>-p 6379:6379:</strong>把容器内的6379端口映射到宿主机6379端口 </li>
<li><strong>-v /root/redis/redis.conf:/etc/redis/redis.conf：</strong>把宿主机配置好的redis.conf放到容器内的这个位置中 </li>
<li><strong>-v /root/redis/data:/data：</strong>把redis持久化的数据在宿主机内显示，做数据备份 </li>
<li><strong>redis-server /etc/redis/redis.conf：</strong>这个是关键配置，让redis不是无配置启动，而是按照这个redis.conf的配置启动 </li>
<li><strong>–appendonly yes</strong>：redis启动后数据持久化</li>
</ul>
<h2 id="微服务docker化"><a href="#微服务docker化" class="headerlink" title="微服务docker化"></a>微服务docker化</h2><h3 id="制作微服务docker镜像"><a href="#制作微服务docker镜像" class="headerlink" title="制作微服务docker镜像"></a>制作微服务docker镜像</h3><p>1.首先拉取并启动一个jdk</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull openjdk:8u191-alpine</span><br><span class="line"></span><br><span class="line">docker run -it --entrypoint bash openjdk:8u191-alpine</span><br></pre></td></tr></table></figure>



<p>2.编写微服务的dockerfile</p>
<p>1.首先将微服务打成jar包</p>
<p>2.DockerFle文件内容(位置假设在微服务的src目录下)</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span>u191-alpine</span><br><span class="line"><span class="keyword">MAINTAINER</span> zln zhoulning@gmail.com</span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> target/user--service-1.0-SNAPSHOT.jar /user-service.jar</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"java"</span>, <span class="string">"-jar"</span>, <span class="string">"/user-service.jar"</span>]</span></span><br></pre></td></tr></table></figure>

<p>3.将服务打成镜像</p>
<p>docker build -t user-service:1.0-SNAPSHOT .</p>
<p>4.运行镜像</p>
<p>docker run -it user-service:1.0-SNAPSHOT –mysql.address=172.171.3.68</p>
<p>其中–mysql.address=172.171.3.68是application.yml中配置的变量${ mysql.address}</p>
<h3 id="微服务docker镜像通信"><a href="#微服务docker镜像通信" class="headerlink" title="微服务docker镜像通信"></a>微服务docker镜像通信</h3><p>创建docker-compose.yml(示例)</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">imooc-network</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">message-service:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">message-service:latest</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">user-service:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">user-service:latest</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">"--mysql.address=172.19.0.2"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">user-edge-service:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">user-edge-service:latest</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">user-service</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">message-service</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">"--redis.address=172.19.0.3"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">course-service:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">course-service:latest</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">user-service</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">"--mysql.address=172.19.0.2"</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">"--zookeeper.address=172.19.0.4"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">course-edge-service:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">course-edge-service:latest</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">user-edge-service</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">"--zookeeper.address=172.19.0.4"</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">api-gateway-zuul:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">api-gateway-zuul:latest</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">course-edge-service</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">user-edge-service</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">8080</span><span class="string">:8080</span></span><br></pre></td></tr></table></figure>

<p>docker-compose运行(docker-compose.yml目录下)：</p>
<p>docker-compose up -d</p>
<h2 id="Docker镜像仓库harbor"><a href="#Docker镜像仓库harbor" class="headerlink" title="Docker镜像仓库harbor"></a>Docker镜像仓库harbor</h2><h3 id="Harbor简介"><a href="#Harbor简介" class="headerlink" title="Harbor简介"></a>Harbor简介</h3><p><strong>1.Harbor介绍</strong></p>
<p>Harbor是一个用于存储和分发Docker镜像的企业级Registry服务器，通过添加一些企业必需的功能特性，例如安全、标识和管理等，扩展了开源Docker Distribution。作为一个企业级私有Registry服务器，Harbor提供了更好的性能和安全。提升用户使用Registry构建和运行环境传输镜像的效率。Harbor支持安装在多个Registry节点的镜像资源复制，镜像全部保存在私有Registry中， 确保数据和知识产权在公司内部网络中管控。另外，Harbor也提供了高级的安全特性，诸如用户管理，访问控制和活动审计等。</p>
<p><strong>2.Harbor特性</strong></p>
<ul>
<li><strong>基于角色的访问控制</strong> ：用户与Docker镜像仓库通过“项目”进行组织管理，一个用户可以对多个镜像仓库在同一命名空间（project）里有不同的权限。</li>
<li><strong>镜像复制</strong> ： 镜像可以在多个Registry实例中复制（同步）。尤其适合于负载均衡，高可用，混合云和多云的场景。</li>
<li><strong>图形化用户界面</strong> ： 用户可以通过浏览器来浏览，检索当前Docker镜像仓库，管理项目和命名空间。</li>
<li><strong>AD/LDAP 支持</strong> ： Harbor可以集成企业内部已有的AD/LDAP，用于鉴权认证管理。</li>
<li><strong>审计管理</strong> ： 所有针对镜像仓库的操作都可以被记录追溯，用于审计管理。</li>
<li><strong>国际化</strong> ： 已拥有英文、中文、德文、日文和俄文的本地化版本。更多的语言将会添加进来。</li>
<li><strong>RESTful API</strong> ： RESTful API 提供给管理员对于Harbor更多的操控, 使得与其它管理软件集成变得更容易。</li>
<li><strong>部署简单</strong> ： 提供在线和离线两种安装工具， 也可以安装到vSphere平台(OVA方式)虚拟设备。</li>
</ul>
<p><strong>3.Harbor组件</strong></p>
<p>Harbor在架构上主要由6个组件构成：</p>
<ul>
<li><strong>Proxy</strong>：Harbor的registry, UI, token等服务，通过一个前置的反向代理统一接收浏览器、Docker客户端的请求，并将请求转发给后端不同的服务。</li>
<li><strong>Registry</strong>： 负责储存Docker镜像，并处理docker push/pull 命令。由于我们要对用户进行访问控制，即不同用户对Docker image有不同的读写权限，Registry会指向一个token服务，强制用户的每次docker pull/push请求都要携带一个合法的token, Registry会通过公钥对token 进行解密验证。</li>
<li><strong>Core services</strong>： 这是Harbor的核心功能，主要提供以下服务：</li>
<li><strong>UI</strong>：提供图形化界面，帮助用户管理registry上的镜像（image）, 并对用户进行授权。</li>
<li><strong>webhook</strong>：为了及时获取registry 上image状态变化的情况， 在Registry上配置webhook，把状态变化传递给UI模块。</li>
<li><strong>token 服务</strong>：负责根据用户权限给每个docker push/pull命令签发token. Docker 客户端向Regiøstry服务发起的请求,如果不包含token，会被重定向到这里，获得token后再重新向Registry进行请求。</li>
<li><strong>Database</strong>：为core services提供数据库服务，负责储存用户权限、审计日志、Docker image分组信息等数据。</li>
<li><strong>Job Services</strong>：提供镜像远程复制功能，可以把本地镜像同步到其他Harbor实例中。</li>
<li><strong>Log collector</strong>：为了帮助监控Harbor运行，负责收集其他组件的log，供日后进行分析。</li>
</ul>
<p><strong>4.Harbor实现</strong></p>
<p>Harbor的每个组件都是以Docker容器的形式构建的，官方也是使用Docker Compose来对它进行部署。用于部署Harbor的Docker Compose模板位于 harbor/docker-compose.yml,打开这个模板文件，发现Harbor是由7个容器组成的；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># docker-compose ps</span><br><span class="line">       Name                     Command               State                                Ports                              </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">harbor-adminserver   &#x2F;harbor&#x2F;harbor_adminserver       Up                                                                      </span><br><span class="line">harbor-db            docker-entrypoint.sh mysqld      Up      3306&#x2F;tcp                                                        </span><br><span class="line">harbor-jobservice    &#x2F;harbor&#x2F;harbor_jobservice        Up                                                                      </span><br><span class="line">harbor-log           &#x2F;bin&#x2F;sh -c crond &amp;&amp; rm -f  ...   Up      127.0.0.1:1514-&gt;514&#x2F;tcp                                         </span><br><span class="line">harbor-ui            &#x2F;harbor&#x2F;harbor_ui                Up                                                                      </span><br><span class="line">nginx                nginx -g daemon off;             Up      0.0.0.0:443-&gt;443&#x2F;tcp, 0.0.0.0:4443-&gt;4443&#x2F;tcp, 0.0.0.0:80-&gt;80&#x2F;tcp</span><br><span class="line">registry             &#x2F;entrypoint.sh serve &#x2F;etc&#x2F; ...   Up      5000&#x2F;tcp</span><br></pre></td></tr></table></figure>



<p><strong>nginx</strong>：nginx负责流量转发和安全验证，对外提供的流量都是从nginx中转，所以开放https的443端口，它将流量分发到后端的ui和正在docker镜像存储的docker registry。<br><strong>harbor-jobservice</strong>：harbor-jobservice 是harbor的job管理模块，job在harbor里面主要是为了镜像仓库之前同步使用的;<br><strong>harbor-ui</strong>：harbor-ui是web管理页面，主要是前端的页面和后端CURD的接口;<br><strong>registry</strong>：registry就是docker原生的仓库，负责保存镜像。<br><strong>harbor-adminserver</strong>：harbor-adminserver是harbor系统管理接口，可以修改系统配置以及获取系统信息。<br>这几个容器通过Docker link的形式连接在一起，在容器之间通过容器名字互相访问。对终端用户而言，只需要暴露proxy （即Nginx）的服务端口。<br><strong>harbor-db</strong>：harbor-db是harbor的数据库，这里保存了系统的job以及项目、人员权限管理。由于本harbor的认证也是通过数据，在生产环节大多对接到企业的ldap中；<br><strong>harbor-log</strong>：harbor-log是harbor的日志服务，统一管理harbor的日志。通过inspect可以看出容器统一将日志输出的syslog。</p>
<p>这几个容器通过Docker link的形式连接在一起，这样，在容器之间可以通过容器名字互相访问。对终端用户而言，只需要暴露proxy （即Nginx）的服务端口。</p>
<h3 id="安装和配置Harbor"><a href="#安装和配置Harbor" class="headerlink" title="安装和配置Harbor"></a>安装和配置Harbor</h3><p><strong>1.环境说明</strong></p>
<table>
<thead>
<tr>
<th>环境名称</th>
<th>版本</th>
</tr>
</thead>
<tbody><tr>
<td>系统版本</td>
<td>CentOS Linux release 7.2.1511 (Core)</td>
</tr>
<tr>
<td>docker-ce</td>
<td>17.03.1-ce</td>
</tr>
<tr>
<td>docker-compose</td>
<td>1.16.1</td>
</tr>
<tr>
<td>Harbor</td>
<td>v1.2.0</td>
</tr>
<tr>
<td>安装方式</td>
<td>在线安装</td>
</tr>
<tr>
<td>安装位置</td>
<td>/usr/local/harbor</td>
</tr>
</tbody></table>
<p><strong>2.首先安装docker</strong></p>
<p>安装Harbor需要先安装docker和docker-compose</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># yum install -y yum-utils \</span><br><span class="line">  device-mapper-persistent-data \</span><br><span class="line">  lvm2</span><br><span class="line">配置repository：</span><br><span class="line"># yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo</span><br><span class="line"></span><br><span class="line">安装最新版本docker-ce   Docker version 17.03.1-ce</span><br><span class="line"># yum install docker-ce</span><br></pre></td></tr></table></figure>

<p>启动docker:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl start docker</span><br></pre></td></tr></table></figure>

<p>如果需要卸载docker-ce，操作如下：<br>yum remove docker-ce<br>卸载后images，containers，volumes，configuration files 是不能自动删除的，为了删除all images，containers，and volumes，请执行如下命令：<br>rm -rf /var/lib/docker</p>
<p><strong>3.安装docker-compose</strong></p>
<p>必须先安装docker</p>
<p>方法一：二进制安装</p>
<p>a.下载二进制文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># curl -L https:&#x2F;&#x2F;github.com&#x2F;docker&#x2F;compose&#x2F;releases&#x2F;download&#x2F;1.16.1&#x2F;docker-compose-&#96;uname -s&#96;-&#96;uname -m&#96; -o &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br></pre></td></tr></table></figure>

<p>如果需要安装其他版本的话，请修改上面命令中的版本号。</p>
<p>b.赋予二进制文件可执行权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br></pre></td></tr></table></figure>

<p>c.根据自己的情况决定是否安装命令补全功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># yum install bash-completion </span><br><span class="line"># curl -L https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;docker&#x2F;compose&#x2F;1.16.1&#x2F;contrib&#x2F;completion&#x2F;bash&#x2F;docker-compose -o &#x2F;etc&#x2F;bash_completion.d&#x2F;docker-compose</span><br></pre></td></tr></table></figure>

<p>重新登陆后就生效了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># docker-compose </span><br><span class="line">build    config   down     exec     images   logs     port     pull     restart  run      start    top      up       </span><br><span class="line">bundle   create   events   help     kill     pause    ps       push     rm       scale    stop     unpause  version</span><br></pre></td></tr></table></figure>

<p>d.测试是否安装成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># docker-compose --version</span><br><span class="line">docker-compose version 1.16.1, build 6d1ac21</span><br></pre></td></tr></table></figure>



<p>方法二：pip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># yum install python-pip</span><br><span class="line"># pip install  docker-compose</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># docker-compose --version</span><br></pre></td></tr></table></figure>

<p>卸载docker-compose<br>对应上面两种安装方法：<br>二进制：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># rm  &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br></pre></td></tr></table></figure>

<p>pip:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># pip uninstall  docker-compose</span><br></pre></td></tr></table></figure>

<p><strong>4.安装Harbor</strong></p>
<p>安装方式分为在线安装和离线安装两种方式，我这里选择的是在线安装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -P &#x2F;usr&#x2F;loca&#x2F;src&#x2F;     https:&#x2F;&#x2F;github.com&#x2F;vmware&#x2F;harbor&#x2F;releases&#x2F;download&#x2F;v1.2.0&#x2F;harbor-online-installer-v1.2.0.tgz</span><br></pre></td></tr></table></figure>

<p>也可以下载下面的文件进行离线安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;vmware&#x2F;harbor&#x2F;releases&#x2F;download&#x2F;v1.2.0&#x2F;harbor-offline-installer-v1.2.0.tgz</span><br></pre></td></tr></table></figure>

<p>不过这个文件，我没有下载成功。因为在亚马逊S3上总是连接超时<br>安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># cd &#x2F;usr&#x2F;local&#x2F;src&#x2F;</span><br><span class="line"># tar zxf harbor-online-installer-v1.2.0.tgz  -C &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line"># cd &#x2F;usr&#x2F;local&#x2F;harbor&#x2F;</span><br></pre></td></tr></table></figure>

<p><strong>5.修改配置文件</strong></p>
<p>配置文件为：/usr/local/harbor/harbor.cfg<br>配置的内容为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># vim &#x2F;usr&#x2F;local&#x2F;harbor&#x2F;harbor.cfg</span><br><span class="line">hostname &#x3D; rgs.unixfbi.com</span><br><span class="line">#邮箱配置</span><br><span class="line">email_server &#x3D; smtp.qq.com</span><br><span class="line">email_server_port &#x3D; 25</span><br><span class="line">email_username &#x3D; unixfbi@unixfbi.com</span><br><span class="line">email_password &#x3D;12345678</span><br><span class="line">email_from &#x3D; UnixFBI &lt;unixfbi@unixfbi.com&gt;</span><br><span class="line">email_ssl &#x3D; false</span><br><span class="line">#禁止用户注册</span><br><span class="line">self_registration &#x3D; off</span><br><span class="line">#设置只有管理员可以创建项目</span><br><span class="line">project_creation_restriction &#x3D; adminonly</span><br></pre></td></tr></table></figure>

<p><strong>6.执行安装脚本</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># &#x2F;usr&#x2F;local&#x2F;harbor&#x2F;install.sh</span><br></pre></td></tr></table></figure>

<p><strong>7.Harbor启动和停止</strong></p>
<p>Harbor 的日常运维管理是通过docker-compose来完成的，Harbor本身有多个服务进程，都放在docker容器之中运行，我们可以通过docker ps命令查看(或者docker-compose 来查看)</p>
<p><strong>8.访问测试</strong></p>
<p>在浏览器输入rgs.unixfbi.com，因为我配置的域名为rgs.unixfbi.com。请大家根据自己的配置情况输入访问的域名；<br>默认账号密码： admin / Harbor12345 登录后修改密码</p>
<h3 id="测试上传和下载镜像"><a href="#测试上传和下载镜像" class="headerlink" title="测试上传和下载镜像"></a>测试上传和下载镜像</h3><p>1.修改各docker client配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># vim &#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;docker.service</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;dockerd --insecure-registry rgs.unixfbi.com</span><br></pre></td></tr></table></figure>

<p>增加 <strong>–insecure-registry rgs.unixfbi.com</strong> 即可。<br>重启docker：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl daemon-reload</span><br><span class="line"># systemctl  restart docker</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">创建&#x2F;etc&#x2F;docker&#x2F;daemon.json文件，在文件中指定仓库地址</span><br><span class="line"># cat &gt; &#x2F;etc&#x2F;docker&#x2F;daemon.json &lt;&lt; EOF</span><br><span class="line">&#123; &quot;insecure-registries&quot;:[&quot;rgs.unixfbi.com&quot;] &#125;</span><br><span class="line">EOF</span><br><span class="line">然后重启docker就可以。</span><br><span class="line"></span><br><span class="line"># systemctl  restart docker</span><br></pre></td></tr></table></figure>

<p>这样设置完成后，就不会提示我们使用https的错误了。</p>
<p>2.创建Dockerfile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># vim Dockerfile </span><br><span class="line">FROM centos:centos7.1.1503</span><br><span class="line">ENV TZ &quot;Asia&#x2F;Shanghai&quot;</span><br></pre></td></tr></table></figure>

<p>3.创建镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># docker build -t rgs.unixfbi.com&#x2F;library&#x2F;centos7.1:0.1 .</span><br></pre></td></tr></table></figure>

<p>4.把镜像push到Harbor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># docker login rgs.unixfbi.com</span><br><span class="line"># docker push rgs.unixfbi.com&#x2F;library&#x2F;centos7.1:0.1</span><br></pre></td></tr></table></figure>

<p>如果不是自己创建的镜像，记得先执行 docker tags 给镜像做tag<br>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># docker pull busybox</span><br><span class="line"># docker tag busybox:latest rgs.unixfbi.com&#x2F;library&#x2F;busybox:latest</span><br><span class="line"># docker push rgs.unixfbi.com&#x2F;library&#x2F;busybox:latest</span><br></pre></td></tr></table></figure>

<p>5.登录web页面查看镜像</p>
<p>6.pull镜像</p>
<p>从别的机器上拉一下镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># docker rmi -f $(docker images -q -a )</span><br><span class="line"># docker pull rgs.unixfbi.com&#x2F;library&#x2F;centos7.1:0.1</span><br><span class="line">0.1: Pulling from library&#x2F;centos7.1</span><br><span class="line">07618ba636d9: Pull complete </span><br><span class="line">Digest: sha256:7f398052ae0e93ddf96ba476185c7f436b15abd27acd848a24b88ede4bb3c322</span><br><span class="line">Status: Downloaded newer image for rgs.unixfbi.com&#x2F;library&#x2F;centos7.1:0.1</span><br><span class="line"></span><br><span class="line"># docker images</span><br><span class="line">REPOSITORY                         TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">rgs.unixfbi.com&#x2F;library&#x2F;centos7.1   0.1                 6c849613a995        5 hours ago         212MB</span><br></pre></td></tr></table></figure>






          
            <br>
            
  
    
    

<section class="widget copyright  desktop mobile">
  <div class='content'>
    
      <blockquote>
        
          
            <p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p>

          
        
          
            <p>本文永久链接是：<a href=https://www.bcoder.top/2019/01/13/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%E5%8C%96%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/>https://www.bcoder.top/2019/01/13/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%E5%8C%96%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/</a></p>
          
        
      </blockquote>
    
  </div>
</section>

  

  
    
    

<section class="widget qrcode  desktop mobile">
  

  <div class='content article-entry'>
    
      
        <div class='fancybox'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/qrcode/wiki_volantis.png'
        
          height='64px'
        ></div>
      
    
      
        <div class='fancybox'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/qrcode/wiki_volantis.png'
        
          height='64px'
        ></div>
      
    
  </div>
</section>

  


          
        </div>
        
          


  <section class='meta' id="footer-meta">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-01-21T18:44:04+08:00">
  <a class='notlink'>
    <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：2020-01-21 18:44:04</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/docker/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>docker</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>微服务</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/CI-CD/" rel="nofollow"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i><p>CI/CD</p></a></div>


        
      
        
          

        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.bcoder.top/2019/01/13/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%E5%8C%96%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/&title=微服务容器化实践（一） - zln's blog&summary=Docker 基础Docker介绍Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从Apache2.0协议开源。
Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。
容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://www.bcoder.top/2019/01/13/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%E5%8C%96%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/&title=微服务容器化实践（一） - zln's blog&summary=Docker 基础Docker介绍Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从Apache2.0协议开源。
Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。
容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=https://www.bcoder.top/2019/01/13/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%E5%8C%96%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%B8%80%EF%BC%89/&title=微服务容器化实践（一） - zln's blog&summary=Docker 基础Docker介绍Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从Apache2.0协议开源。
Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。
容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。"
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
          <div class="prev-next">
            
              <a class='prev' href='/2019/01/19/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%B9%E5%99%A8%E5%8C%96%E5%AE%9E%E8%B7%B5%EF%BC%88%E4%BA%8C%EF%BC%89/'>
                <p class='title'><i class="fas fa-chevron-left" aria-hidden="true"></i>微服务容器化实践（二）</p>
                <p class='content'>Kubernetes基础Kubernetes介绍首先，Kubernetes是一个全新的基于容器技术的分布式架构领先方案。Kubernetes是Google开源的容器集群管理系统，其提供应用部署、...</p>
              </a>
            
            
              <a class='next' href='/2019/01/12/%E7%BC%93%E5%AD%98%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%8F%8A%E5%85%B6%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/'>
                <p class='title'>缓存常见问题及其解决办法<i class="fas fa-chevron-right" aria-hidden="true"></i></p>
                <p class='content'>为什么出现缓存？随着互联网系统发展的逐步完善，提高系统的qps，目前的绝大部分系统都增加了缓存机制从而避免请求过多的直接与数据库操作从而造成系统瓶颈，极大的提升了用户体验和系统稳定性。



缓...</p>
              </a>
            
          </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  <article class="post white-box comments shadow">
    <section class="article typo">
      <p ct><i class='fas fa-comments'></i> 评论</p>
      
      
      
      
      
        <section id="comments">
          <div id="valine_container" class="valine_thread">
            <i class="fas fa-spinner fa-spin fa-fw"></i>
          </div>
        </section>
      
    </section>
  </article>


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: '微服务容器化实践（一）',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
  

  
    
    


  <section class="widget toc-wrapper shadow desktop mobile">
    
  <header>
    
      <i class="fas fa-list fa-fw" aria-hidden="true"></i><span class='name'>本文目录</span>
    
  </header>


    <div class='content'>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-基础"><span class="toc-number">1.</span> <span class="toc-text">Docker 基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker介绍"><span class="toc-number">1.1.</span> <span class="toc-text">Docker介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker应用场景"><span class="toc-number">1.2.</span> <span class="toc-text">Docker应用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker优点"><span class="toc-number">1.3.</span> <span class="toc-text">Docker优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker安装（以ubuntu-16-04-为例）"><span class="toc-number">1.4.</span> <span class="toc-text">Docker安装（以ubuntu 16.04 为例）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker镜像操作"><span class="toc-number">1.5.</span> <span class="toc-text">Docker镜像操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker容器操作"><span class="toc-number">1.6.</span> <span class="toc-text">Docker容器操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker常用镜像安装"><span class="toc-number">1.7.</span> <span class="toc-text">Docker常用镜像安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-安装-Nginx"><span class="toc-number">1.7.1.</span> <span class="toc-text">Docker 安装 Nginx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-安装-MySQL"><span class="toc-number">1.7.2.</span> <span class="toc-text">Docker 安装 MySQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-安装-Tomcat"><span class="toc-number">1.7.3.</span> <span class="toc-text">Docker 安装 Tomcat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-安装-Redis"><span class="toc-number">1.7.4.</span> <span class="toc-text">Docker 安装 Redis</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#微服务docker化"><span class="toc-number">2.</span> <span class="toc-text">微服务docker化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#制作微服务docker镜像"><span class="toc-number">2.1.</span> <span class="toc-text">制作微服务docker镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#微服务docker镜像通信"><span class="toc-number">2.2.</span> <span class="toc-text">微服务docker镜像通信</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker镜像仓库harbor"><span class="toc-number">3.</span> <span class="toc-text">Docker镜像仓库harbor</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Harbor简介"><span class="toc-number">3.1.</span> <span class="toc-text">Harbor简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装和配置Harbor"><span class="toc-number">3.2.</span> <span class="toc-text">安装和配置Harbor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试上传和下载镜像"><span class="toc-number">3.3.</span> <span class="toc-text">测试上传和下载镜像</span></a></li></ol></li></ol>
    </div>
  </section>


  


</aside>


  
  <footer class="clearfix">
    <br><br>
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="https://www.bcoder.top"
                class="social fas fa-rss flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="mailto:me@xaoxuu.com"
                class="social fas fa-envelope flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://github.com/zlnnjit"
                class="social fab fa-github flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://music.163.com/#/user/home?id=430673592"
                class="social fas fa-headphones-alt flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
        </div>
      
    
      
        Use
        <a href="https://bcoder.top/" target="_blank" class="codename">周陆宁</a>
        as theme
        
          , 
          total visits
          <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
          times
        
      
    
      
        <div class='copyright'>
        <p><a href="https://bocder.top" target="_blank" rel="noopener">Copyright © 2016-2020 zlnnjit</a></p>

        </div>
      
    
  </footer>

<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4/dist/jquery.min.js"></script>


  <script>
    
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>



  
<script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>

  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>



  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/xaoxuu/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('.cover') {
          $('.cover').backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        }
      });
    </script>
  



  
    
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js" async></script>

  
    
<script src="https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js" async></script>

  








  
    
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.2.0/js/valine.js"></script>

  
  <script>
  var GUEST_INFO = ['nick','mail','link'];
  var guest_info = 'nick,mail,link'.split(',').filter(function(item){
    return GUEST_INFO.indexOf(item) > -1
  });
  var notify = 'true' == true;
  var verify = 'true' == true;
  var valine = new Valine();
  valine.init({
    el: '#valine_container',
    notify: notify,
    verify: verify,
    guest_info: guest_info,
    
    appId: "M3YhrSNLSJTxyKwa8hGSGbH7-gzGzoHsz",
    appKey: "RwjMsAULtRweeA4GtaqJGPVu",
    placeholder: "快来评论吧~",
    pageSize:'10',
    avatar:'mp',
    lang:'zh-cn',
    visitor: 'false',
    highlight:'true'
  })
  </script>



  
<script src="/js/app.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2.1/js/search.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-volantis@2/js/comment_typing.js"></script>



<!-- 复制 -->

  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copyed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-clipboard-check');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPYED';
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('fa-copy');
        $icon.addClass('fa-exclamation-triangle');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
      });
    }
    initCopyCode();
  }(window, document);
</script>




<!-- fancybox -->

  <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("div.fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>






  <script>setLoadingBarProgress(100);</script>
</body>
</html>
